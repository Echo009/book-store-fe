<!DOCTYPE html>
<html lang="en">
<head>
    <!--
* Author : Ech0
* Email  : ech0.extreme@foxmail.com
* Time   : 04/16/2018 09:40 AM
*-->
    <meta charset="UTF-8">
    <title>L-Store</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!--lib-->
    <script src="../lib/jquery/jquery.js"></script>
    <link rel="stylesheet" href="../lib/bootstrap/bootstrap.css">
    <script src="../lib/bootstrap/popper.js"></script>
    <script src="../lib/bootstrap/bootstrap.js"></script>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css"
          integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">
    <!--sweetalert-->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://cdn.bootcss.com/store.js/1.3.20/store.js"></script>
    <script src="https://cdn.bootcss.com/axios/0.18.0/axios.js"></script>
    <script src="../js/constant.js"></script>
    <script src="../js/common.js"></script>
    <!--todo modify-->
    <link rel="stylesheet" href="../css/custom.css">
</head>
<body>
<div class="container ">

    <!--顶部固定导航 -->
    <div class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary ">
        <div class="container">
            <a href="index.html" class="navbar-brand">L-store</a>
            <!--菜单按钮-->
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                    aria-controls="" navbarResponsive aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <!--菜单-->
            <div class="collapse navbar-collapse text-center" id="navbarResponsive">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#">帮助</a>
                    </li>
                    <!--分类下拉框-->
                    <li class="nav-item dropdown ">
                        <div class="nav-link dropdown-toggle btn btn-primary" data-toggle="dropdown"><span
                                id="searchOption" class="pl-2">所有分类</span> <span class="caret"></span></div>
                        <div class="dropdown-menu ">
                            <!--fixed category -->
                            <div class="search-option dropdown-item">小说</div>
                            <div class="search-option dropdown-item">文学</div>
                            <div class="search-option dropdown-item">艺术</div>
                            <div class="search-option dropdown-item">卡通</div>
                            <div class="search-option dropdown-item">教育</div>
                            <div class="search-option dropdown-item">历史</div>
                            <div class="search-option dropdown-item">科技</div>
                            <hr>
                            <div class="search-option dropdown-item">所有分类</div>
                        </div>
                    </li>
                    <li class="nav-item ml-3 text-center">
                        <!--搜索框-->
                        <form class="form-inline mt-2 mt-md-0 ">
                            <input id="search-keyword" class="form-control mr-sm-2" type="text" placeholder="">
                        </form>
                    </li>
                    <li class="nav-item ml-3 text-center">
                        <div id="search-btn" class="btn btn-secondary  my-2 my-sm-0">搜索</div>
                    </li>
                </ul>
                <div id="login-links" class="text-center">
                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="./login.html#1" target="_top">登录</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./login.html#2" target="_top">注册</a>
                        </li>
                    </ul>
                </div>
                <!--已经登录-->
                <div id="personal-links" class="d-none text-center">
                    <div class="nav navbar-nav mr-auto ">
                        <div class="nav-item mr-3">
                            <div class="btn-group" role="group" aria-label="Basic example">
                                <button type="button" class="btn btn-primary"
                                        onclick="window.location.href='./personal-center.html?target-panel=cart-info'">
                                    购物车
                                </button>
                                <button type="button" class="btn btn-primary"
                                        onclick="window.location.href='./personal-center.html?target-panel=personal-info'">
                                    个人中心
                                </button>
                                <div class="btn-group" role="group">
                                    <button id="btnGroupDrop2" type="button" class="btn btn-success dropdown-toggle"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
                                    <div class="dropdown-menu" aria-labelledby="btnGroupDrop2">
                                        <a class="dropdown-item" href="#"><i class="far fa-file-alt"></i>我的订单</a>
                                        <a class="dropdown-item"
                                           href="./personal-center.html?target-panel=favorite-product"><i
                                                class="fas fa-heart"></i>商品收藏</a>
                                        <a class="dropdown-item" href="#"><i class="far fa-thumbs-up"></i>店铺收藏</a>
                                        <a class="dropdown-item"
                                           href="./personal-center.html?target-panel=personal-info"><i
                                                class="far fa-user"></i>个人信息</a>
                                        <a class="dropdown-item" href="./personal-center.html?target-panel=addr-manage"><i
                                                class="far fa-paper-plane"></i>地址管理</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="nav-item">
                            <div class="nav-link btn" onclick="logout()">退出</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
        <!--轮播图+广告推荐-->
        <div class="row clearfix mt-2">
            <!--轮播图片-->
            <div class="col-lg-8 col-sm-12">
                <div id="carouselExampleIndicators" class="carousel slide  d-inline-block" data-ride="carousel">
                    <ol class="carousel-indicators">
                        <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                    </ol>
                    <div class="carousel-inner d-inline-block">
                        <!--todo-->
                        <a href="bookDetail.html?bookId=28" class="carousel-item">
                            <img class="d-block w-100" src="http://img63.ddimg.cn/topic_img/gys_04083/750315xinhua.jpg"
                                 alt="Third slide">
                            <div class="carousel-caption d-none d-md-block">
                                <h5>...</h5>
                                <p>...</p>
                            </div>
                        </a>
                        <a href="bookDetail.html?bookId=11" class="carousel-item ">
                            <img class="d-block w-100"
                                 src="http://img60.ddimg.cn/upload_img/00316/zhulin/750-3152-1522662898.jpg"
                                 alt="Second slide">
                        </a><a href="bookDetail.html?bookId=10" class="carousel-item active">
                        <img class="d-block w-100 "
                             src="http://img60.ddimg.cn/upload_img/00316/zhulin/750-3152-1522662898.jpg"
                             alt="First slide">

                    </a>
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
            <!--广告，简单列表+小号轮播图-->
            <div class="col-lg-4 d-none d-md-block ">
                <div class="row  ">
                    <div class="card w-100 ">
                        <div class="card-header">最新动态</div>
                        <div class="card-body pb-0 pt-3">
                            <!--todo-->
                            <ul>
                                <li><a href="./newso.html" class="card-link ">第13届“文津图书奖”获奖名单</a></li>
                                <li><a href="#" class="card-link ">纪念：胡耀邦主席逝世29周年！</a></li>
                                <li><a href="#" class="card-link ">春光灿烂，文艺励志每100减40</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="row mt-1">
                    <div id="demo" class="carousel slide" data-ride="carousel">

                        <!-- 指示符 -->
                        <ul class="carousel-indicators">
                            <li data-target="#demo" data-slide-to="0" class="active"></li>
                            <li data-target="#demo" data-slide-to="1"></li>
                            <li data-target="#demo" data-slide-to="2"></li>
                        </ul>

                        <!-- 轮播图片 -->
                        <div class="carousel-inner">
                            <a href="bookDetail.html?bookId=8" class="carousel-item active">
                                <img class="img-thumbnail"
                                     src="https://static.runoob.com/images/mix/img_fjords_wide.jpg">
                            </a>
                            <a href="bookDetail.html?bookId=7" class="carousel-item">
                                <img class="img-thumbnail"
                                     src="https://static.runoob.com/images/mix/img_nature_wide.jpg">
                            </a>
                            <a href="bookDetail.html?bookId=12" class="carousel-item">
                                <img class="img-thumbnail"
                                     src="https://static.runoob.com/images/mix/img_mountains_wide.jpg">
                            </a>
                        </div>

                        <!-- 左右切换按钮 -->
                        <a class="carousel-control-prev" href="#demo" data-slide="prev">
                            <span class="carousel-control-prev-icon"></span>
                        </a>
                        <a class="carousel-control-next" href="#demo" data-slide="next">
                            <span class="carousel-control-next-icon"></span>
                        </a>

                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <!--mid 9:3-->
            <!--min 12:0-->
            <div class="col-sm-12 col-md-9">
                <!--导航栏  分类-->
                <ul class="nav nav-tabs pt-2 w-100">
                    <li class="nav-item">
                        <a class="category-option nav-link active" data-toggle="tab">小说</a>
                    </li>
                    <li class="nav-item">
                        <a class="category-option nav-link" data-toggle="tab">文学</a>
                    </li>
                    <li class="nav-item">
                        <a class="category-option nav-link" data-toggle="tab">艺术</a>
                    </li>
                    <li class="nav-item">
                        <a class="category-option nav-link" data-toggle="tab">卡通</a>
                    </li>
                    <li class="nav-item">
                        <a class="category-option nav-link" data-toggle="tab">教育</a>
                    </li>
                    <li class="nav-item">
                        <a class="category-option nav-link" data-toggle="tab">科技</a>
                    </li>
                    <li class="nav-item">
                        <a class="category-option nav-link" data-toggle="tab">历史</a>
                    </li>
                </ul>
                <div id="empty-tip" class="row w-100  d-none ">
                    <h6 id="" class="col-12 h5  text-center  w-100 h-100 font-weight-bold text-dark ">抱歉， (｡í _
                        ì｡) ，人家暂时找不到 <span></span>相关的书籍 。 。 。
                    </h6>
                    <h7 class="col-12 text-center w-100">
                        不妨看看下面这些书籍吧 ！
                    </h7>
                    <hr class="col">
                </div>

                <div class="row" id="books-container">
                    <!-- 书籍列表-->
                    <!--todo-->
                </div>
                <div class="row">
                    <div class="col-12  ">
                        <ul id="pagination-container" class="pagination float-right ">

                        </ul>
                    </div>

                </div>
            </div>

            <!--todo-->
            <!--畅销排行榜-->
            <div class="col-md-3 pt-2  pr-0 d-none d-md-block">
                <div class="card mb-3">
                    <h3 id="ranking-list" class="card-header ranking-title pb-1 pt-1">
                        <img src="../img/common/ranking.png" alt="">
                        图书畅销榜
                    </h3>
                    <ul class="list-group list-group-flush text-omit">
                        <a href="bookDetail.html?bookId=4" class="list-group-item list-group-item-light text-nowrap">1.
                            刺杀骑士团长</a>
                        <a href="bookDetail.html?bookId=8" class="list-group-item list-group-item-light">2. 清单人生</a>
                        <a href="bookDetail.html?bookId=12" class="list-group-item list-group-item-light">3.人生的枷锁</a>
                        <a href="bookDetail.html?bookId=9" class="list-group-item list-group-item-light">4. 尤尔小屋</a>
                        <a href="bookDetail.html?bookId=11" class="list-group-item list-group-item-light">5. 摆渡人2</a>
                        <a href="bookDetail.html?bookId=7" class="list-group-item list-group-item-light">6. 纸上寻仙记</a>
                        <a href="bookDetail.html?bookId=5" class="list-group-item list-group-item-light">7.
                            愿你，归来仍是少年</a>
                        <a href="bookDetail.html?bookId=10" class="list-group-item list-group-item-light">8. 白夜行</a>
                        <a href="bookDetail.html?bookId=6" class="list-group-item list-group-item-light">9. 所有遗憾都是成全</a>
                        <a href="bookDetail.html?bookId=13" class="list-group-item list-group-item-light">10.
                            遇到一些人，流泪</a>
                        <a href="bookDetail.html?bookId=14" class="list-group-item list-group-item-light">11.
                            橘子不是唯一的水果</a>
                        <a href="bookDetail.html?bookId=15" class="list-group-item list-group-item-light">12.
                            14只老鼠的故事</a>

                    </ul>
                    <div class="card-footer text-muted text-right">
                        <a href="#" class="card-link ">查看更多>></a>
                    </div>
                </div>
            </div>
        </div>
        <div class="row w-100 border  mb-3"></div>
        <footer class="text-muted text-center ">
            Copyright © 2018 Lan-store Powered by <a href="http://lan.echo0.cn">lan.echo0.cn</a>
        </footer>
    </div>
</body>
<script>

    $(function () {
        initBooksContainer("小说");
        // 检查登录状态
        var currentUser = store.get(CURRENT_USER);
        try {
            if (currentUser.userName) {
                console.log("current user : " + currentUser.userName);
                $("#login-links").addClass("d-none");
                $("#personal-links").removeClass("d-none");
            }
        } catch (e) {
            console.log("not login !");
        }
        $(document).on("click", ".category-option", function () {
            var $this = $(this);
            initBooksContainer($this.text());
        });

    });

    function initBooksContainer(category, pageNum) {
        console.log("category :" + category);
        console.log("pageNum :" + pageNum);
        if ("undefined" == typeof pageNum) {
            pageNum = 1;
        }
        const params = new URLSearchParams();
        params.append("category", category);
        params.append("pageNum", pageNum);
        instance.post('/bookInfo/search', params)
            .then(function (response) {
                var totalPages = response.data.data.totalPages;
                var totalElements = response.data.data.totalElements;
                var currentPage = response.data.data.currentPage;
                if (totalElements > 0) {
                    $("#empty-tip").addClass("d-none");
                    initProductContainer("#books-container", response.data.data.content);
                    initPaginationContainer(currentPage, totalPages, "", "");
                    fixPaginagtion();
                } else {
                    $("#empty-tip").removeClass("d-none");
                    const params = new URLSearchParams();
                    params.append("pageNum", 1);
                    instance.post('/bookInfo/search', params)
                        .then(function (response) {
                            var totalPages = response.data.data.totalPages;
                            var totalElements = response.data.data.totalElements;
                            initProductContainer("#books-container", response.data.data.content);
                            initPaginationContainer(currentPage, totalPages, "", "");
                            fixPaginagtion();
                            console.log("total pages   :" + response.data.data.totalPages);
                            console.log("total element  :" + response.data.data.totalElements);
                        })
                        .catch(function (error) {
                            console.log(error);
                        });

                }

                console.log("total pages   :" + response.data.data.totalPages);
                console.log("total element  :" + response.data.data.totalElements);
            })
            .catch(function (error) {
                console.log(error);
            });

    }

    function fixPaginagtion() {

        $("#pagination-container").children().each(function (index, ele) {
            $(ele).children("a").attr("href", "#");
        })
        $(".page-link").on("click", function () {

            var category;
            $(".category-option").each(function (index, ele) {
                if ($(ele).hasClass("active")) {
                    category = $(ele).text();
                }
            });
            initBooksContainer(category, $(this).text());
        })

    }

</script>
</html>