<!DOCTYPE html>
<html lang="en">
<head>
    <!--
* Author : Ech0
* Email  : ech0.extreme@foxmail.com
* Time   : 04/17/2018 01:32 PM
*-->
    <meta charset="UTF-8">
    <title>L-Store</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!--lib-->
    <script src="../lib/jquery/jquery.js"></script>
    <link rel="stylesheet" href="../lib/bootstrap/bootstrap.css">
    <link rel="stylesheet" href="../css/floating-label.css">
    <script src="../lib/bootstrap/popper.js"></script>
    <script src="../lib/bootstrap/bootstrap.js"></script>
    <!--sweetalert-->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <!--todo modify-->
    <link rel="stylesheet" href="../css/custom.css">
    <script src="../js/common.js"></script>
    <style>

        body {
            background-image: url("../img/background/book.jpg");
            background-size: cover;
        }
    </style>
</head>
<body>

<div class="container">
    <form class="form-signin rounded" id="signin-panel">
        <div class="text-center mb-4">

            <h4 class=" mb-3 font-weight-normal">喵 ，ο(=•ω＜=)ρ⌒☆</h4>
            <p>欢迎来到 Lan-store </p>
        </div>

        <div class="form-label-group">
            <input type="text" id="username" class="form-control " placeholder="手机号 or 用户名" required autofocus>
            <label for="username"> 手机号 or 昵称 ~</label>
            <div class="invalid-feedback">该昵称或手机号码不存在 QAQ ~</div>
        </div>

        <div class="form-label-group">
            <input type="password" id="password" class="form-control" placeholder="Password" required>
            <label for="password"> 您的密码 ~ </label>
            <div class="invalid-feedback">密码错误 ， QAQ ~</div>
        </div>

        <div class="checkbox mb-3 float-left">
            <label>
                <input type="checkbox" value="remember-me"> 记住密码
            </label>
        </div>
        <a href="./register.html" class="float-right">注册>></a>

        <div class="btn btn-lg btn-primary clearfix w-100  text-center" onclick="login()">登录</div>
        <p class="mt-5 mb-3 text-muted text-center">&copy; 2018 Lan-store &nbsp;
            Power by <a href="http://lan.echo0.cn "> lan.echo0.cn </a>
        </p>
    </form>
    <div class="modal" id="modal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Modal body text goes here.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary">Save changes</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
<script>
    function login() {
        var username = $("#username").val();
        var password = $("#password").val();
        // use phone?
        var myreg = /^[1][3,4,5,7,8][0-9]{9}$/;
        if (myreg.test(username)) {
            $.ajax("http://localhost/book-store/userInfo/checkUserPhone", {
                //提交数据的类型 POST GET
                type: "POST",
                async: false,
                data: {
                    phone: username
                },
                crossDomain: true,
                datatype: "json",
                // 携带认证信息 如cookie
                xhrFields: {withCredentials: true},
                //成功返回之后调用的函数
                success: function (data, status, xhr) {
                    if (data.code == 0) {
                        // is valid
                        $("#username").removeClass("is-invalid");

                        $.ajax("http://localhost/book-store/common/login", {
                            //提交数据的类型 POST GET
                            type: "POST",
                            async: false,
                            data: {
                                phone: username,
                                password: password
                            },
                            crossDomain: true,
                            datatype: "json",
                            // 携带认证信息 如cookie
                            xhrFields: {withCredentials: true},
                            //成功返回之后调用的函数
                            success: function (data, status, xhr) {
                                if (data.code == 0) {
                                    // is valid
                                    $("#password").removeClass("is-invalid");
//                                    todo
                                    simpleSuccessInfo("登录成功");

                                } else {
                                    $("#password").addClass("is-invalid");
                                    $("#password").focus();
                                    return;
                                }
                            }
                        })

                    } else {
                        $("#username").addClass("is-invalid");
                        $("#username").focus();
                        return;
                    }
                }
            })
        } else {
            // check username
            $.ajax("http://localhost/book-store/userInfo/checkUserName", {
                //提交数据的类型 POST GET
                type: "POST",
                async: false,
                data: {
                    userName: username
                },
                crossDomain: true,
                datatype: "json",
                // 携带认证信息 如cookie
                xhrFields: {withCredentials: true},
                //成功返回之后调用的函数
                success: function (data, status, xhr) {
                    if (data.code == 0) {
                        // is valid
                        $("#username").removeClass("is-invalid");

                        $.ajax("http://localhost/book-store/common/login", {
                            //提交数据的类型 POST GET
                            type: "POST",
                            async: true,
                            data: {
                                userName: username,
                                password: password
                            },
                            crossDomain: true,
                            datatype: "json",
                            // 携带认证信息 如cookie
                            xhrFields: {withCredentials: true},
                            //成功返回之后调用的函数
                            success: function (data, status, xhr) {
                                if (data.code == 0) {
                                    // is valid
                                    $("#password").removeClass("is-invalid");
                                    simpleSuccessInfo("登录成功");
                                } else {
                                    $("#password").addClass("is-invalid");
                                    $("#password").focus();
                                    return;
                                }
                            }
                        })

                    } else {
                        $("#username").addClass("is-invalid");
                        $("#username").focus();
                        return;
                    }
                }

            });

        }
    };
</script>
</html>