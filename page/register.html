<!DOCTYPE html>
<html lang="en">
<head>
    <!--
* Author : Ech0
* Email  : ech0.extreme@foxmail.com
* Time   : 04/17/2018 02:47 PM
*-->
    <meta charset="UTF-8">
    <title>L-Store</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!--lib-->
    <script src="../lib/jquery/jquery.js"></script>
    <link rel="stylesheet" href="../lib/bootstrap/bootstrap.css">
    <script src="../lib/bootstrap/popper.js"></script>
    <script src="../lib/bootstrap/bootstrap.js"></script>
    <!--todo modify-->
    <link rel="stylesheet" href="../css/custom.css">
</head>
<body>
<div class="container">
    <form class="form-register   rounded">
        <div class="text-center mb-4">

            <h4 class=" mb-3 font-weight-normal">喵 ，ο(=•ω＜=)ρ⌒☆</h4>
            <p>欢迎来到 Lan-store <a href=""></a></p>
        </div>

        <div class="form-group  ">
            <label class="form-control-label" for="username">昵称</label>
            <!-- is-valid   is-invalid -->
            <input type="text" class="form-control " id="username" onkeyup="checkUserName()">
            <div class="valid-feedback">恭喜，您可以使用该昵称 ~</div>
            <div class="invalid-feedback">对不起，该昵称已经被使用 QAQ ~</div>
        </div>
        <div class="form-group ">
            <label class="form-control-label" for="phone">手机号码</label>
            <!-- is-valid   is-invalid -->
            <input type="number" class="form-control " id="phone" onkeyup="checkPhone()">
            <div class="valid-feedback ">当前手机号可以使用 ~</div>
            <div class="invalid-feedback ">对不起，该手机号已经被使用，请更换~</div>
        </div>
        <div class="form-group">
            <label for="email">Email address</label>
            <input type="email" class="form-control" id="email" aria-describedby="emailHelp">
            <small id="emailHelp" class="form-text text-muted">请放心填写，我们不会向任何人泄露您的邮箱信息 ~</small>
        </div>
        <div class="form-group ">
            <label class="form-control-label" for="password">密码 </label>
            <input type="password" class="form-control is-valid" id="password">
        </div>
        <div class="form-group ">
            <label class="form-control-label" for="password-repeat">请再次输入密码 </label>
            <input type="password" class="form-control is-valid" id="password-repeat">
            <div class="invalid-feedback d-none">两次输入的密码不一致，请重新输入哦~</div>
        </div>
        <a href="./login.html" class="float-right">登录>></a>
        <div  class="btn btn-lg btn-primary clearfix btn-block mt-5"  onclick="register()">注册</div>
        <p class="mt-5 mb-3 text-muted text-center">&copy; 2018 Lan-store &nbsp;
            Power by <a href="http://lan.echo0.cn "> lan.echo0.cn </a>
        </p>
    </form>
</div>
</body>
<script>

    // 校验用户名
    function checkUserName() {
        var userName = $("#username").val();
        $.ajax("http://localhost/book-store/userInfo/checkUserName", {
            //提交数据的类型 POST GET
            type: "POST",
            async: true,
            data: {
                userName: userName
            },
            crossDomain: true,
            datatype: "json",
            // 携带认证信息 如cookie
            xhrFields: {withCredentials: true},
            //成功返回之后调用的函数
            success: function (data, status, xhr) {
                if (data.code != 1) {
                    // has exist
                    $("#username").removeClass("is-valid");
                    $("#username").addClass("is-invalid");
                } else {
                    $("#username").removeClass("is-invalid");
                    $("#username").addClass("is-valid");
                }
            }
        })
    };

    // 校验手机号码
    function checkPhone() {
        var phone = $("#phone").val();
        if (phone.length >= 11) {
            $.ajax("http://localhost/book-store/userInfo/checkUserPhone", {
                //提交数据的类型 POST GET
                type: "POST",
                async: true,
                data: {
                    phone: phone
                },
                crossDomain: true,
                datatype: "json",
                // 携带认证信息 如cookie
                xhrFields: {withCredentials: true},
                //成功返回之后调用的函数
                success: function (data, status, xhr) {
                    if (data.code != 1) {
                        // has exist
                        $("#phone").removeClass("is-valid");
                        $("#phone").addClass("is-invalid");
                    } else {
                        $("#phone").removeClass("is-invalid");
                        $("#phone").addClass("is-valid");
                    }
                }
            })
        }
    };

    function register() {
        if ($("#username").hasClass("is-invalid")) {
            $("#username").focus();
        }
        else if ($("#phone").hasClass("is-invalid")) {
            $("#phone").focus();
        } else {

            var password1 = $("#password").val();
            var password2 = $("#password-repeat").val();
            if (password1 != password2) {
                $("#password-repeat").addClass("is-invalid");
                return false;
            }else {
                $("#password-repeat").removeClass("is-invalid");
            }
            var userName = $("#username").val();
            var phone = $("#phone").val();
            var email = $("#email").val();

            $.ajax("http://localhost/book-store/common/register", {
                //提交数据的类型 POST GET
                type: "POST",
                async: true,
                data: {
                    userName: userName,
                    phone: phone,
                    password: password2,
                    email: email
                },
                crossDomain: true,
                datatype: "json",
                // 携带认证信息 如cookie
                xhrFields: {withCredentials: true},
                //成功返回之后调用的函数
                success: function (data, status, xhr) {

                    if (data.code == 0) {
                        // success
                        alert("注册成功！")
                        window.location = "./login.html"
                    }
                    else {
//                       alert(data.desc);

                    }

                }
            })
        }
        return false;
    }
</script>
</html>